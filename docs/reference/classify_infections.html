<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Classify Infections Using a Bayesian MCMC Framework — classify_infections • MalReBay</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Classify Infections Using a Bayesian MCMC Framework — classify_infections"><meta name="description" content="This is the main user-facing function of the MalReBay package. It runs the
complete Bayesian analysis workflow to classify parasite infections as either
recrudescence or reinfection based on genotyping data. The function handles
data import, MCMC simulation with automatic convergence checking, and the
summarization and saving of final results."><meta property="og:description" content="This is the main user-facing function of the MalReBay package. It runs the
complete Bayesian analysis workflow to classify parasite infections as either
recrudescence or reinfection based on genotyping data. The function handles
data import, MCMC simulation with automatic convergence checking, and the
summarization and saving of final results."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">MalReBay</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/MalReBay.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/SwissTPH/MalReBay/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Classify Infections Using a Bayesian MCMC Framework</h1>
      <small class="dont-index">Source: <a href="https://github.com/SwissTPH/MalReBay/blob/HEAD/R/MalReBay.R" class="external-link"><code>R/MalReBay.R</code></a></small>
      <div class="d-none name"><code>classify_infections.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This is the main user-facing function of the <code>MalReBay</code> package. It runs the
complete Bayesian analysis workflow to classify parasite infections as either
recrudescence or reinfection based on genotyping data. The function handles
data import, MCMC simulation with automatic convergence checking, and the
summarization and saving of final results.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">classify_infections</span><span class="op">(</span><span class="va">input_filepath</span>, <span class="va">mcmc_config</span>, <span class="va">output_folder</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-input-filepath">input_filepath<a class="anchor" aria-label="anchor" href="#arg-input-filepath"></a></dt>
<dd><p>A character string. The full path to the input Excel file
containing the cleaned genotyping data.</p></dd>


<dt id="arg-mcmc-config">mcmc_config<a class="anchor" aria-label="anchor" href="#arg-mcmc-config"></a></dt>
<dd><p>A list of MCMC configuration parameters. See Details for
a full list of options and their defaults.</p></dd>


<dt id="arg-output-folder">output_folder<a class="anchor" aria-label="anchor" href="#arg-output-folder"></a></dt>
<dd><p>A character string specifying the path to the folder where
all results (summary CSVs, diagnostic plots) will be saved. The folder
will be created if it does not exist.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A list containing two data frames:</p>
<dl><dt>summary</dt>
<dd><p>A data frame summarizing the main results for each patient,
including the posterior probability of recrudescence and a summary of the
genetic data available for comparison.</p></dd>

<dt>marker_details</dt>
<dd><p>A detailed data frame providing the mean likelihood ratio
and mean allele distance for each genetic marker for each patient, offering
locus-specific insights into the classification.</p></dd>

</dl><p>Two CSV files corresponding to these data frames are also saved to the
<code>output_folder</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The function operates by first importing and validating the data from the
provided Excel file. It automatically detects the data type (length-polymorphic
or amplicon sequencing) and selects the appropriate MCMC engine. The MCMC simulation
is run in parallel across multiple chains and proceeds in chunks, stopping
automatically when convergence criteria are met or the maximum number of
iterations is reached.</p>
<p>The <code>mcmc_config</code> list provides fine-grained control over the simulation.
Key parameters include:</p><ul><li><p><strong><code>n_chains</code></strong>: Number of parallel chains to run. (Default: 4).</p></li>
<li><p><strong><code>chunk_size</code></strong>: Number of iterations per chunk. After each chunk,
convergence is assessed. (Default: 10000).</p></li>
<li><p><strong><code>max_iterations</code></strong>: The maximum total number of iterations before
the simulation is forcibly stopped, even if not converged. (Default: 100000).</p></li>
<li><p><strong><code>burn_in_frac</code></strong>: The fraction of initial samples to discard
from each chain before summarizing results. (Default: 0.25).</p></li>
<li><p><strong><code>rhat_threshold</code></strong>: The Gelman-Rubin diagnostic threshold for
convergence. (Default: 1.01).</p></li>
<li><p><strong><code>ess_threshold</code></strong>: The Effective Sample Size threshold for
convergence. (Default: 400).</p></li>
<li><p><strong><code>record_hidden_alleles</code></strong>: A logical flag. If <code>TRUE</code>, the full
state of imputed hidden alleles is saved. This can generate very large
output files and is mainly for debugging. (Default: FALSE).</p></li>
</ul><p>Any parameters not specified in the list will use the default values.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Get the path to the example data file included with the package</span></span></span>
<span class="r-in"><span><span class="va">example_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"Angola_2021_TES_7NMS.xlsx"</span>,</span></span>
<span class="r-in"><span>                            package <span class="op">=</span> <span class="st">"MalReBay"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Create a temporary directory to save the results for this example</span></span></span>
<span class="r-in"><span><span class="va">temp_output_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"MalReBay_example"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">temp_output_dir</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Define a minimal MCMC configuration for a quick and illustrative run</span></span></span>
<span class="r-in"><span><span class="co"># NOTE: These settings are for demonstration only and are not sufficient</span></span></span>
<span class="r-in"><span><span class="co"># for a real analysis.</span></span></span>
<span class="r-in"><span><span class="va">quick_mcmc_config</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  n_chains <span class="op">=</span> <span class="fl">2</span>,</span></span>
<span class="r-in"><span>  chunk_size <span class="op">=</span> <span class="fl">500</span>,</span></span>
<span class="r-in"><span>  max_iterations <span class="op">=</span> <span class="fl">500</span>, <span class="co"># Set max_iterations equal to chunk_size for one run</span></span></span>
<span class="r-in"><span>  rhat_threshold <span class="op">=</span> <span class="fl">1.1</span>, <span class="co"># Relaxed for the example</span></span></span>
<span class="r-in"><span>  ess_threshold <span class="op">=</span> <span class="fl">50</span>   <span class="co"># Relaxed for the example</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># Run the full analysis</span></span></span>
<span class="r-in"><span><span class="va">results_list</span> <span class="op">&lt;-</span> <span class="fu">classify_infections</span><span class="op">(</span></span></span>
<span class="r-in"><span>  input_filepath <span class="op">=</span> <span class="va">example_file</span>,</span></span>
<span class="r-in"><span>  mcmc_config <span class="op">=</span> <span class="va">quick_mcmc_config</span>,</span></span>
<span class="r-in"><span>  output_folder <span class="op">=</span> <span class="va">temp_output_dir</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># View the top rows of the main summary table</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">results_list</span><span class="op">$</span><span class="va">summary</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># View the top rows of the detailed marker-level table</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">results_list</span><span class="op">$</span><span class="va">marker_details</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Veronica Adhiambo Ochieng, Mateusz Plucinski, Monica Golumbeanu.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

